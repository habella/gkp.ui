@if (isOpen()) {
  <!-- Backdrop -->
  <div class="modal-backdrop" (click)="onBackdropClick()"></div>

  <!-- Modal Container -->
  <div class="modal-container">
    <div
      class="modal-content"
      [ngClass]="getSizeClass()"
      (click)="$event.stopPropagation()"
    >
      <!-- Header -->
      <div class="modal-header" [class.loading]="confirmLoading()">
        <div class="modal-header-left">
          <div class="modal-title-row">
            @if (headerIcon()) {
              <span class="modal-icon">
                <ng-container *ngTemplateOutlet="headerIcon()!" />
              </span>
            }
            <h2 class="modal-title">{{ title() }}</h2>
          </div>
          @if (subtitle()) {
            <p class="modal-subtitle" [class.with-icon]="headerIcon()">
              {{ subtitle() }}
            </p>
          }
        </div>

        <div class="modal-header-right">
          <!-- Custom header actions -->
          @if (headerActions()) {
            <ng-container *ngTemplateOutlet="headerActions()!" />
          }

          <!-- Close button -->
          @if (showCloseButton()) {
            <button
              type="button"
              class="modal-close-btn"
              [disabled]="confirmLoading()"
              (click)="onClose()"
              title="Cerrar"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          }
        </div>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <ng-content />
      </div>

      <!-- Footer -->
      @if (showFooter()) {
        <div class="modal-footer">
          <div class="modal-footer-left">
            @if (footerExtra()) {
              <ng-container *ngTemplateOutlet="footerExtra()!" />
            }
          </div>

          <div class="modal-footer-right">
            @if (showCancelButton()) {
              <button
                type="button"
                class="btn-secondary"
                [disabled]="confirmLoading()"
                (click)="onCancel()"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
                {{ cancelText() }}
              </button>
            }
            @if (showConfirmButton()) {
              <button
                type="button"
                [class]="getConfirmClass()"
                [disabled]="confirmDisabled() || confirmLoading()"
                (click)="onConfirm()"
              >
                <div class="flex items-center justify-center gap-2">
                  @if (confirmLoading()) {
                    <svg
                      class="animate-spin"
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      fill="none"
                      viewBox="0 0 24 24"
                    >
                      <circle
                        class="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"
                      ></circle>
                      <path
                        class="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                      ></path>
                    </svg>
                  } @else {
                    @if (confirmIcon()) {
                      <i
                        [class]="'dx-icon-' + confirmIcon()"
                        class="text-base"
                      ></i>
                    } @else {
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                    }
                  }
                  <span class="whitespace-nowrap">{{ confirmText() }}</span>
                </div>
              </button>
            }
          </div>
        </div>
      }
    </div>
  </div>
}
